# Customer Analytics API

This is a FastAPI-based backend service designed to provide customer report generation and AI-powered analytics on sales data. It processes CSV files containing orders and products information to deliver detailed reports and answer user queries using an AI model powered by OpenAI.

## Features

- **Generate Detailed Sales Reports**: Create comprehensive sales reports for specific customers based on their orders and product data.
- **AI-Powered Data Queries**: Ask questions about sales data and receive insightful answers generated by an AI model.
- **Log Retrieval**: Access recent log entries for debugging and monitoring purposes.

## Installation

Follow these steps to set up the project locally:

1. **Clone the Repository**:
git clone https://github.com/yourusername/customer-analytics-api.git
cd customer-analytics-api

2. **Create and Activate a Virtual Environment**:
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

3. **Install Dependencies**:
pip install -r requirements.txt


## Configuration

The application requires an OpenAI API key to enable AI functionalities. Configure it as follows:

- **Set the Environment Variable**:
export OPENAI_API_KEY='your-api-key-here'

- **Alternatively, Use a `.env` File**:
Create a `.env` file in the root directory with the following content:


## Usage

Run the application with the following command:
uvicorn main:app --host 0.0.0.0 --port 8080


Once running, the API will be accessible at `http://localhost:8080`.

## Endpoints Documentation

### 1. Generate Reports

- **URL**: `/generate-reports/{customer_id}`
- **Method**: POST
- **Description**: Generates a sales report for the specified customer based on their orders and products data.
- **Path Parameters**:
  - `customer_id` (string): The unique identifier of the customer.
- **Response**:
  ```json
  {
    "status": "success",
    "customer_id": "string",
    "file_path_product": "string",
    "file_path_orders": "string",
    "report": "object"
  }
status: Indicates the success or failure of the operation.
customer_id: The customer ID provided in the request.
file_path_product: Path to the products CSV file (e.g., data/{customer_id}/orderProducts.csv).
file_path_orders: Path to the orders CSV file (e.g., data/{customer_id}/orders.csv).
report: The generated sales report content.

2. Ask AI
URL: /Ask_ai
Method: POST
Description: Allows users to query the sales data with a prompt, receiving an AI-generated response.
Query Parameters:
file_path_product (string): Path to the products CSV file.
file_path_orders (string): Path to the orders CSV file.
Request Body:
{
  "prompt": "string"
}
prompt: The question or statement to be analyzed by the AI.
Response
{
  "response": "object",
  "prompt": "string",
  "cost": "float"
}

response: The AI's answer, including metadata such as token usage and execution time.
prompt: The original user prompt.
cost: The estimated cost of the AI request based on token usage.

3. Get Last N Log Lines
URL: /logs/last/{num_lines}
Method: GET
Description: Retrieves the last specified number of lines from the log file.
Path Parameters:
num_lines (integer): The number of log lines to return.
Response: Plain text containing the requested log lines.

Key dependencies include:

FastAPI: For building the API.
Pandas: For data manipulation and analysis.
LangChain: For integrating AI capabilities with dataframes.
OpenAI: For AI-powered analytics.
Uvicorn: ASGI server to run the application.
Refer to requirements.txt for the full list.

Logging
Logs are saved to project_log.log in the root directory. Use the /logs/last/{num_lines} endpoint to retrieve recent entries for monitoring or debugging.

Performance and Cost Considerations
Concurrent Processing: The application uses a ProcessPoolExecutor to handle AI requests efficiently, leveraging multiple CPU cores.
Cost Transparency: Each AI request returns a cost field based on OpenAI token usage (input: $0.0025/1000 tokens, output: $0.01/1000 tokens).
Rate Limits: Be aware of OpenAI API rate limits and monitor your key's usage to ensure uninterrupted service.

Example Usage
1. Generate Reports
   curl -X POST http://localhost:8080/generate-reports/123
2. Ask AI
First, note the file paths from the /generate-reports response, then:

curl -X POST "http://localhost:8080/Ask_ai?file_path_product=data/123/orderProducts.csv&file_path_orders=data/123/orders.csv" \
     -H "Content-Type: application/json" \
     -d '{"prompt": "What are the sales trends?"}'
  Returns an AI-generated response based on the provided data files.

3. Get Last 10 Log Lines
   curl http://localhost:8080/logs/last/10
License
This project is licensed under the MIT License. See the LICENSE file for details (assumed MIT; confirm with the project owner if necessary).
